close all
clear all

numberElementsU = 1;
numberElementsV = 1;
p = 2;
q = 2;

R=0.2;
%define geometry on coarsest mesh
knotU = [0, 0, 0, 1, 1, 1];
knotV = [0, 0, 0, 1, 1, 1];

coefs(1:3,1,1) = [0;2;0];
coefs(1:3,1,2) = [1;2;0];
coefs(1:3,1,3) = [2;2;0];

coefs(1:3,2,1) = [0;1;0];
coefs(1:3,2,2) = [1;1;0];
coefs(1:3,2,3) = [2;1;0];

coefs(1:3,3,1) = [0;0;0];
coefs(1:3,3,2) = [1;0;0];
coefs(1:3,3,3) = [2;0;0];

coefs(4,:,:) = 1;

surf1 = nrbmak(coefs, {knotU, knotV});

%nrbctrlplot(surf1)

coefs(1:3,1,1) = [2;2;0];
coefs(1:3,1,2) = [3;2.2;0];
coefs(1:3,1,3) = [4;2.4;0];

coefs(1:3,2,1) = [2;1;0];
coefs(1:3,2,2) = [3;1;0];
coefs(1:3,2,3) = [4;1;0];

coefs(1:3,3,1) = [2;0;0];
coefs(1:3,3,2) = [3;0;0];
coefs(1:3,3,3) = [4;0;0];

coefs(4,:,:) = 1;

% surf2 = nrbmak(coefs, {knotU, knotV});
% hold on
% nrbctrlplot(surf2)

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

a = sqrt(2)/2;
%define geometry on coarsest mesh
knotU = [0, 0, 0, 1, 1, 1];
knotV = [0, 0, 0, 1, 1, 1];

coefs(1:3,1,1) = [a; -a; 0];
coefs(1:3,1,2) = [0; -1; 0];
coefs(1:3,1,3) = [-a; -a; 0];

coefs(1:3,2,1) = [2; -2; 0];
coefs(1:3,2,2) = [0; -4; 0];
coefs(1:3,2,3) = [-2; -2; 0];

coefs(1:3,3,1) = [4; -4; 0];
coefs(1:3,3,2) = [0; -4; 0];
coefs(1:3,3,3) = [-4; -4; 0];

coefs(4,1,1) = 1;
coefs(4,1,2) = a;
coefs(4,1,3) = 1;
coefs(4,2,1) = 1;
coefs(4,2,2) = 1;
coefs(4,2,3) = 1;
coefs(4,3,1) = 1;
coefs(4,3,2) = 1;
coefs(4,3,3) = 1;


surf = nrbmak(coefs, {knotU, knotV});
%nrbctrlplot(surf)
surf = nrbkntins(surf,{[0.5,0.5] [0.5,0.5]});
surf.coefs(4,:,:)=1;
% nrbctrlplot(surf)

coefs=[];
coefs(:,:,1) =[ 0.707106781186548      2.176776695296637    4.000000000000000;...
    -0.707106781186548    -2.176776695296637  -4.000000000000000;...
    0                       0                          0;...
    1.000000000000000    1.000000000000000   1.000000000000000];


coefs(:,:,2) =[0.353553390593274     1.088388347648319     2.000000000000000;...
    -0.853553390593274   -2.713388347648318   -4.000000000000000;...
    0                            0                      0;...
    1.000000000000000     1.000000000000000    1.000000000000000];


coefs(:,:,3) =[              0                                 0                        0;...
    -0.853553390593274   -2.713388347648318    -4.000000000000000;...
    0                      0                      0;...
    1.000000000000000    1.000000000000000     1.000000000000000];

surf = nrbmak(coefs, {knotU, knotV});
% figure
% nrbctrlplot(surf)


coefs(:,:,1) =[              0                                 0                        0;...
    -0.853553390593274   -2.713388347648318    -4.000000000000000;...
    0                      0                      0;...
    1.000000000000000    1.000000000000000     1.000000000000000];

coefs(:,:,2) =[             -1                                 -1                       -1;...
    -0.853553390593274   -2.713388347648318    -4.000000000000000;...
    0                      0                      0;...
    1.000000000000000    1.000000000000000     1.000000000000000];


coefs(:,:,3) =[             -2                               -2                      -2;...
    -0.853553390593274   -2.713388347648318    -4.000000000000000;...
    0                      0                      0;...
    1.000000000000000    1.000000000000000     1.000000000000000];


surf = nrbmak(coefs, {knotU, knotV});
%nrbctrlplot(surf)


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%


a = 1/sqrt(2);
innerRad=1;
outerRad=3;
coefs=[];
coefs(1:3,1,1) = [innerRad;0;0];
coefs(1:3,1,2) = [innerRad*a;innerRad*a;0];
coefs(1:3,1,3) = [0;innerRad;0];

coefs(4,1,1) = 1;
coefs(4,1,2) = a;
coefs(4,1,3) = 1;


% coefs(1:3,2,1) = [outerRad;0;0];
% coefs(1:3,2,2) = [outerRad*a;outerRad*a;0];
% coefs(1:3,2,3) = [0;outerRad;0];

coefs(1:3,2,1) = [outerRad;0;0];
coefs(1:3,2,2) = [outerRad/2;outerRad/2;0];
coefs(1:3,2,3) = [0;outerRad;0];

coefs(4,2,1) = 1;
coefs(4,2,2) = 1;
coefs(4,2,3) = 1;

knotU = [0 0 1 1];
knotV = [0 0 0 1 1 1];
surf1 = nrbmak(coefs, {knotU, knotV});

knotU = surf1.knots{1};
knotV = surf1.knots{2};
coefs = surf1.coefs;
surf = nrbmak(coefs, {knotU, knotV});
%figure
%nrbctrlplot(surf)

%isrf = nrbkntins(surf,{[0.5] [0.5,0.5]});
%figure
%nrbctrlplot(isrf)

%coefs=isrf.coefs;

coefs=[];
knotU = [0 0 0.5 1 1];
knotV = [0 0 0 0.5 0.5 1 1 1];

coefs(:,:,1) =[ 1     2     3;...
    0     0     0;...
    0     0     0;...
    1     1     1];


coefs(:,:,2) =[ 0.853553390593274   1.551776695296637   2.250000000000000;...
    0.353553390593274   0.551776695296637   0.750000000000000;...
    0                   0                   0;...
   0.853553390593274   0.926776695296637  1.000000000000000];


coefs(:,:,3) =[0.603553390593274   1.051776695296637   1.500000000000000;...
    0.603553390593274   1.051776695296637   1.500000000000000;...
    0                   0                   0;...
   0.853553390593274   0.926776695296637   1.000000000000000];


coefs(:,:,4) =[0.353553390593274   0.551776695296637   0.750000000000000;...
    0.853553390593274   1.551776695296637   2.250000000000000;...
    0                   0                   0;...
    0.853553390593274   0.926776695296637  1.000000000000000];


coefs(:,:,5) =[0     0     0;...
    1     2     3;...
    0     0     0;...
    1     1     1];



surf = nrbmak(coefs, {knotU, knotV});
figure
nrbctrlplot(surf)

rotAngle = pi/4;
pnt = [0,0,0];
T  = vectrans(pnt);
rotMatrix = vecrotz(rotAngle);
T2 = vectrans(-pnt);

surf2  = nrbtform(surf ,T*rotMatrix*T2);
figure
nrbctrlplot(surf2)

coefs=surf2.coefs
for j=1:size(coefs,3)
    for i=1:size(coefs,2)
   i
   j
    P=coefs(:,i,j);
    hold on
    plot(P(1),P(2),'*k')
    pause
    
    end
end

% coefs(:,:,4) =[-0.353553390593274  -0.676776695296637  -1.088388347648319  -1.500000000000000  -2.000000000000000;...
%  -0.853553390593274  -1.926776695296637  -2.713388347648318  -3.500000000000000  -4.000000000000000;...
%                    0                   0                   0                   0                   0;...
%    1.000000000000000   1.000000000000000   1.000000000000000   1.000000000000000   1.000000000000000];


% coefs(:,:,5) =[-0.707106781186548  -1.353553390593274  -2.176776695296637  -3.000000000000000  -4.000000000000000;...
%  -0.853553390593274  -1.926776695296637  -2.713388347648318  -3.500000000000000  -4.000000000000000;...
%                    0                   0                   0                   0                   0;...
%    1.000000000000000   1.000000000000000   1.000000000000000   1.000000000000000   1.000000000000000];


